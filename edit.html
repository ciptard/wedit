<div id="address">
<table width="100%"><tbody><tr>
<td>[#path#]</td>
<td align="right"><h1>Wedit</h1></td>
</tr></tbody></table>
</div>
<div id="status">[#status#]</div>
<div id="text"><textarea id="contents" disabled="true"></textarea></div>

<div id="buttons">
<table id="buttons-table" width="100%"><tbody><tr><td width="33%">
<input type="button" value="[#Save#]" onclick="saveFile();"/>
</td>
<td align="center">
Кодировка: <input class="field" id="encoding" type="text" size="10" value=""/>
</td>
<td width="33%" align="right">
<input type="button" value="[#Reload#]" onclick="reloadFile();"/>
</td></tr></tbody></table>
</div>

<input id="filename" type="hidden" value="[#filename#]"/>

<script type="text/javascript" language="javascript">

//Сохранить файл
function saveFile()
{
  $('#status').html(t('Saving')+'&hellip;');
  content = $('#contents');
  content.attr('disabled', 'true');
  var filename = $('#filename').val();
  if (filename != '' && filename != null) {
    $.ajax({
      type: "POST",
      url: "file.php",
      data: { 
        operation: "save",
        filename: filename,
        filecontent: $('textarea#contents').val(),
        encoding: $('input#encoding').val()
      }
    }).done(function(msg) {
      content.removeAttr('disabled');
      var result = jQuery.parseJSON(msg);
      //Обновим состояние
      if (result.code != false) {
        $('#status').html('<span class="textsaved">' + result.status + '</span>');
      }
      else {
        $('#status').html('<span class="texterror">' + result.status + '</span>');
      }
    });
  }
}

//Перечитать файл
function reloadFile()
{
  $('#status').html(t('Reloading'));
  content = $('#contents');
  content.attr('disabled', 'true');
  var filename = $('#filename').val();
  if (filename != '' && filename != null) {
    $.ajax({
      type: "POST",
      url: "file.php",
      data: { 
        operation: "load",
        filename: filename,
        encoding: $('input#encoding').val()
      }
    }).done(function(msg) {
      content.removeAttr('disabled');
      var result = jQuery.parseJSON(msg);
      //Обновим состояние
      $('#status').html(result.status);
      $('textarea#contents').val(result.content);
    });
  }
}

</script>