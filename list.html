<div>[#info#]</div>
<p>[#path#]</p>
<hr>
<div>[#list#]</div>
<hr>
<div id="buttons">
<input type="button" value="&uarr; [#Upload#]&hellip;" onclick="uploadFile();"/>
<input type="button" value="&darr; [#Download#]" onclick="downloadFile();"/>
<input type="button" value="[#Create#]&hellip;" onclick="createFile();"/>
<input type="button" value="[#Change#]&hellip;" onclick="changeFile();"/>
<input type="button" value="&empty; [#Delete#]&hellip;" onclick="deleteFile();"/>
</div>

<div id="dialog" style="display: none;">
<form id="dialog" method="post">
</form>
</div>

<div style="display: none;">
<form id="cancel" method="post">
</form>
<form id="download" method="post">
</form>
</div>

<script type="text/javascript" language="javascript">
//Доступность кнопок
function enableButtons(enable)
{
  if (enable) {
    $(':button').removeAttr('disabled');
  }
  else {
    $(':button').attr('disabled', 'true');
  }
}

//Доступность чекбоксов
function enableCheckbox(enable)
{
  if (enable) {
    $(':checkbox[id^=f_*]').removeAttr('disabled');
  }
  else {
    $(':checkbox[id^=f_*]').attr('disabled', 'true');
  }
}


//Создать файл
function createFile()
{
  enableButtons(false);
  enableCheckbox(false);
  $('#files').append('<tr id="files_create_row">'+
  	'<td></td>'+
  	'<td><input id="_newname" type="string" size=15 value="new.txt"/></td>'+
  	'<td><select id="_newtype"><option>'+t('Directory')+'</option><option selected>'+t('File')+'</option></select></td>'+
  	'<td></td>'+
  	'<td></td>'+
  	'<td></td>'+
//  	'<td></td>'+
  	'<td><form id="create" method="post">'+
  	  '<input id="operation" name="operation" type="hidden" value="create"/>'+
  	  '<input id="newname" name="newname" type="hidden"/>'+
  	  '<input id="newtype" name="newtype" type="hidden"/>'+
  	  '<input id="newok" type="button" value="'+t('OK')+'" onclick="sendCreateFile();"/>'+
  	  '<input id="newcancel" type="button" value="'+t('Cancel')+'" onclick="cancelCreateFile();"/>'+
  	'</form></td>'+
  	'</tr>');
}

function sendCreateFile()
{
  $('#newname').val($('#_newname').val());
  $('#newtype').val($('#_newtype').val());
  $('#create').submit();
}

function cancelCreateFile()
{
  enableButtons(true);
  enableCheckbox(true);
  $('#files_create_row').remove();
}


//Изменить файл
function changeFile()
{
  if ($('input:checked[id^=f_*]').length != 1) {
    alert(t('You must select only one file for this operation'));
    return;
  }

  enableButtons(false);
  enableCheckbox(false);
  var row = $('input:checked[id^=f_*]').parent().parent();
  var old_filename = row.children('td:eq(1)').children('a').html();
  row.children('td:eq(1)').html(
    '<input type="text" id="_changename" size=15 value="'+old_filename+'"/>'
  );
  row.children('td:eq(6)').html(
    '<form id="change" method="post">'+
      '<input id="operation" name="operation" type="hidden" value="change"/>'+
      '<input id="oldname" name="oldname" type="hidden" value="'+old_filename+'"/>'+
      '<input id="changename" name="changename" type="hidden"/>'+
      '<input id="change_ok" type="button" value="'+t('OK')+'" onclick="sendChangeFile();"/>'+
      '<input id="change_cancel" type="button" value="'+t('Cancel')+'" onclick="cancelChangeFile();"/>'+
    '</form>'
  );
}

function sendChangeFile()
{
  $('#changename').val($('#_changename').val());
  $('#change').submit();
}

function cancelChangeFile()
{
  $('#cancel').submit();
}


//Удалить файл
function deleteFile()
{
  if ($('input:checked[id^=f_*]').length < 1) {
    alert(t('You must select one or more files for this operation'));
    return;
  }

  enableButtons(false);
  enableCheckbox(false);
  $('#buttons').hide();
  var row;
  var filelist = new Array();
  var filename;
  var filenames = '<h2>'+t('Do you really want to delete next files')+'?</h2>';
  filenames += '<ul>';

  $('input:checked[id^=f_*]').each(function (i, el) {
    row = $(el).parent().parent();
    filename = row.children('td:eq(1)').children('a').html();
    filenames += '<li>'+filename+'</li>';
    filelist[filelist.length] = filename;
  });
  filenames += '</ul>';
  filenames += 
    '<form id="delete" method="post">'+
      '<input id="operation" name="operation" type="hidden" value="delete"/>'+
      '<input id="filelist" name="filelist" type="hidden"/>'+
      '<input id="delete_ok" type="button" value="'+t('Delete')+'" onclick="sendDeleteFile();"/>'+
      '<input id="delete_cancel" type="button" value="'+t('Cancel')+'" onclick="cancelChangeFile();"/>'+
    '</form>';

  $('#dialog').html(filenames);
  $('#filelist').val(JSON.stringify(filelist));
  $('#dialog').show();
}

function sendDeleteFile()
{
  $('#delete').submit();
}

function cancelDeleteFile()
{
  $('#cancel').submit();
}


//Загрузить файл
function uploadFile()
{
  enableButtons(false);
  enableCheckbox(false);
  $('#buttons').hide();
  var dialog = '<h2>'+t('Select files for upload')+'</h2>';
  dialog += 
    '<form id="upload" method="post" enctype="multipart/form-data">'+
      '<input id="operation" name="operation" type="hidden" value="upload"/>'+
      '<input id="filelist" name="file[]" type="file" multiple="true"/>'+
      '<input id="delete_ok" type="button" value="'+t('Upload')+'" onclick="sendUploadFile();"/>'+
      '<input id="delete_cancel" type="button" value="'+t('Cancel')+'" onclick="cancelUploadFile();"/>'+
    '</form>';

  $('#dialog').html(dialog);
  $('#dialog').show();
}

function sendUploadFile()
{
  $('#upload').submit();
}

function cancelUploadFile()
{
  $('#cancel').submit();
}


//Скачать файлы/каталоги
function downloadFile()
{
  var selected = $('input:checked[id^=f_*]').length;
  if (selected < 1) {
    alert(t('You must select one or more files for this operation'));
    return;
  }

  var filelist = new Array();

  $('input:checked[id^=f_*]').each(function (i, el) {
    row = $(el).parent().parent();
    filename = row.children('td:eq(1)').children('a').html();
    filelist[filelist.length] = filename;
  });

  var file = '';
  if (selected == 1) {
    file = '<input id="filename" name="filename" type="hidden" value="'+filename+'"/>';
  }

  var row = $('input:checked[id^=f_*]').parent().parent();
  var filename = row.children('td:eq(1)').children('a').html();
  $('#download').html(
    '<input id="operation" name="operation" type="hidden" value="download"/>'+
    '<input id="filelist" name="filelist" type="hidden"/>'+
    file
  );
  $('#filelist').val(JSON.stringify(filelist));
  $('#download').submit();
}

</script>